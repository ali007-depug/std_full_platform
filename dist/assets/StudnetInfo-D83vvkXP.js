import{r as u,j as e,_ as C,g as E}from"./index-Ml_KNG5k.js";import{b as T,c as G,C as U}from"./Dashboard-C66-1ZLo.js";import{G as V}from"./iconBase-CQF-UyDZ.js";import"./react-Csw2ODfV.js";import"./firebase-BHdF2iRg.js";import"./PopupError-Dxxjt6wA.js";function q(d){return V({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 7l16 0"},child:[]},{tag:"path",attr:{d:"M10 11l0 6"},child:[]},{tag:"path",attr:{d:"M14 11l0 6"},child:[]},{tag:"path",attr:{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"},child:[]},{tag:"path",attr:{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"},child:[]}]})(d)}const W=["ممتاز","جيد جداً","جيد","مقبول","راسب"],Z=u.memo(function({selectedBatchId:s,showNewStdForm:k,students:h,setStudents:$,fetchStudents:b,studentsLoading:D,handleEditStd:L,handleSuspend:A,handleDeleteStd:I}){const[p,M]=u.useState(null),[v,y]=u.useState(!1),[R,N]=u.useState(!1),[f,j]=u.useState({});console.log("studentInfo renderd..."),u.useEffect(()=>{let t=!0;return t&&(b(s),console.log(s),console.log("Fetch function recreated")),()=>{t=!1}},[s,b]);const z=(t,c)=>{M(p===t?null:t),w(t,c)},w=async(t,c)=>{const{collection:a,getDocs:l}=await C(async()=>{const{collection:r,getDocs:n}=await import("./firebase-BHdF2iRg.js").then(x=>x.e);return{collection:r,getDocs:n}},[]),o=await E();try{N(!0);const r=a(o,`batches/${s}/students/${t}/semesters/${c}/courses`),x=(await l(r)).docs.map(i=>({id:i.id,name:i.data().name,grade:i.data().grade,degree:i.data().degree})),m=h.map(i=>i.id===t?{...i,stdCourses:x}:i);$(m)}catch(r){console.error("Failed to fetch courses",r)}finally{N(!1)}},F=async t=>{if(!s)return;y(!0);const{doc:c,getDoc:a,updateDoc:l}=await C(async()=>{const{doc:r,getDoc:n,updateDoc:x}=await import("./firebase-BHdF2iRg.js").then(m=>m.e);return{doc:r,getDoc:n,updateDoc:x}},[]),o=await E();try{const r=c(o,"batches",s),n=await a(r);if(!n.exists())throw new Error("Batch not found");const x=n.data().currentSem,i=Object.entries(f).map(async([S,{grade:_,degree:g}])=>{if(!_||g==null||g<0||g>100){console.warn(`Invalid grade or degree for ${S}`);return}const O=c(o,`batches/${s}/students/${t}/semesters/${x}/courses/${S.toLowerCase()}`);await l(O,{grade:_,degree:g}),j({})});await Promise.all(i),w(t,x)}catch(r){console.error("Error updating courses:",r)}finally{y(!1)}};return e.jsxs("div",{className:"w-full bg-sky-200 rounded overflow-y-scroll max-h-[90dvh] relative top-10",children:[e.jsxs("div",{className:"grid grid-cols-[30px_70px_1fr_70px_70px] sm:grid-cols-[repeat(2,110px)_3fr_1fr_1fr] gap-1 sm:gap-4 text-center font-bold py-2 px-4 bg-blue-300 text-gray-950 sticky top-0 z-10",children:[e.jsx("div",{children:"No"}),e.jsx("div",{children:"ID"}),e.jsx("div",{children:"Name"}),e.jsx("div",{children:"Courses"}),e.jsx("div",{children:"Actions"})]}),D?e.jsx("div",{className:"text-center p-4 text-gray-700",children:"Loading students..."}):h.length===0?e.jsxs("div",{className:"text-center p-4 text-gray-600",children:["No students found in batch ",s]}):h.map((t,c)=>e.jsxs("div",{className:"border-b px-4 relative",children:[e.jsxs("div",{className:"grid grid-cols-[30px_70px_1fr_70px_70px] sm:grid-cols-[repeat(2,110px)_3fr_1fr_1fr] gap-1 sm:gap-4 text-center items-center py-2 text-gray-900",children:[e.jsx("div",{children:c+1}),e.jsx("div",{children:t.stdId}),e.jsx("div",{children:t.name}),e.jsx("button",{onClick:()=>z(t.id,t.currentSem),className:"flex justify-center",children:e.jsx(T,{className:`size-7 text-violet-500 bg-white rounded hover:bg-gray-200 transition duration-300 cursor-pointer ${p===t.id?"rotate-[-180deg]":""}`})}),e.jsxs("div",{className:"flex justify-center gap-2 [&_button]:cursor-pointer",children:[e.jsx("button",{className:"hover:bg-blue-300 p-2 rounded",onClick:()=>L(t.id),children:e.jsx(G,{size:20,color:"blue"})}),e.jsx("button",{className:"hover:bg-blue-200 p-2 rounded ",onClick:()=>A(t.id),children:e.jsx(U,{size:20,color:`${t.suspend?"red":"green"}`})}),e.jsx("button",{className:"hover:bg-red-200 p-2 rounded",onClick:()=>I(t.id,t.currentSem),children:e.jsx(q,{size:20,color:"red"})})]})]}),p===t.id&&e.jsx("div",{className:"mt-2 mb-4 py-2 rounded-md bg-sky-100 space-y-2 [direction:rtl]",children:R?e.jsx("p",{className:"text-center py-4",children:"جاري تحميل بيانات الطالب..."}):e.jsxs("div",{className:"grid grid-cols-4 gap-4 p-4 items-center",children:[e.jsx("div",{className:"font-bold text-gray-700 text-center",children:"اسم المقرر"}),e.jsx("div",{className:"font-bold text-gray-700 text-center",children:"التقدير الحالي"}),e.jsx("div",{className:"font-bold text-gray-700 text-center",children:"إضافة تقدير جديد"}),e.jsx("div",{className:"font-bold text-gray-700 text-center",children:"إضافة درجة جديدة"}),t.stdCourses?.map((a,l)=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold text-center",children:a.name},`${l}-name`),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-700",children:a.grade||"N/A"}),e.jsx("p",{className:"text-sm text-gray-700",children:a.degree??"N/A"})]},`${l}-current`),e.jsx("div",{className:"flex justify-center",children:e.jsxs("select",{value:a.name&&f[a?.name]?.grade||"",onChange:o=>{if(!a?.name)return;const r=a.name;j(n=>({...n,[r]:{...n[r],grade:o.target.value}}))},className:"border px-2 py-1 rounded w-full max-w-[120px]",children:[e.jsx("option",{value:"",children:"التقدير"}),W.map(o=>e.jsx("option",{value:o,children:o},o))]})},`${l}-grade`),e.jsx("div",{className:"flex justify-center",children:e.jsx("input",{type:"number",min:0,max:100,placeholder:"الدرجة",value:a.name&&f[a.name]?.degree||"",onChange:o=>{if(!a.name)return;const r=a.name;j(n=>({...n,[r]:{...n[r],degree:Number(o.target.value)}}))},className:"border px-2 py-1 rounded w-full max-w-[100px] text-center"})},`${l}-degree`)]})),e.jsx("div",{className:"col-span-4 flex justify-center mt-4",children:e.jsx("button",{className:"bg-green-700 text-white px-6 py-2 rounded cursor-pointer",onClick:()=>F(t.id),disabled:v,children:v?"جاري التحديث...":"حفظ البيانات"})})]})})," "]},t?.id)),e.jsx("div",{className:"text-center fixed bottom-0 right-80 my-8",children:e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white font-bold px-6 py-2 rounded cursor-pointer",onClick:k,children:"+ إضافة طالب جديد"})})]})},B);function B(d,s){return d.selectedBatchId===s.selectedBatchId&&d.showNewStdForm===s.showNewStdForm&&d.students===s.students&&d.studentsLoading===s.studentsLoading&&d.handleEditStd.toString()===s.handleEditStd.toString()&&d.handleSuspend.toString()===s.handleSuspend.toString()&&d.handleDeleteStd.toString()===s.handleDeleteStd.toString()}export{Z as default};
