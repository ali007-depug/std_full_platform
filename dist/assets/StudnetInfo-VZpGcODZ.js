import{r as c,j as e,c as z,d as p,g as F,f as S,h as R,n as G}from"./index-Cy3cA8Gh.js";import{b as O,c as T,C as U}from"./Dashboard-Dxcm3iw3.js";import{G as q}from"./iconBase-BU23cjlB.js";import"./PopupError-D_xzBCjo.js";function W(n){return q({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 7l16 0"},child:[]},{tag:"path",attr:{d:"M10 11l0 6"},child:[]},{tag:"path",attr:{d:"M14 11l0 6"},child:[]},{tag:"path",attr:{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"},child:[]},{tag:"path",attr:{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"},child:[]}]})(n)}const B=["ممتاز","جيد جداً","جيد","مقبول","راسب"],X=c.memo(function({selectedBatchId:a,showNewStdForm:w,students:m,setStudents:C,fetchStudents:f,studentsLoading:_,handleEditStd:k,handleSuspend:$,handleDeleteStd:E}){const[u,L]=c.useState(null),[j,b]=c.useState(!1),[A,N]=c.useState(!1),[h,g]=c.useState({});console.log("studentInfo renderd..."),c.useEffect(()=>{let t=!0;return t&&(f(a),console.log(a),console.log("Fetch function recreated")),()=>{t=!1}},[a,f]);const D=(t,o)=>{L(u===t?null:t),v(t,o)},v=async(t,o)=>{try{N(!0);const s=z(p,`batches/${a}/students/${t}/semesters/${o}/courses`),d=(await F(s)).docs.map(r=>({id:r.id,name:r.data().name,grade:r.data().grade,degree:r.data().degree})),i=m.map(r=>r.id===t?{...r,stdCourses:d}:r);C(i)}catch(s){console.error("Failed to fetch courses",s)}finally{N(!1)}},I=async t=>{if(a){b(!0);try{const o=S(p,"batches",a),s=await R(o);if(!s.exists())throw new Error("Batch not found");const l=s.data().currentSem,i=Object.entries(h).map(async([r,{grade:y,degree:x}])=>{if(!y||x==null||x<0||x>100){console.warn(`Invalid grade or degree for ${r}`);return}const M=S(p,`batches/${a}/students/${t}/semesters/${l}/courses/${r.toLowerCase()}`);await G(M,{grade:y,degree:x}),g({})});await Promise.all(i),v(t,l)}catch(o){console.error("Error updating courses:",o)}finally{b(!1)}}};return e.jsxs("div",{className:"w-full bg-sky-200 rounded overflow-y-scroll max-h-[90dvh] relative top-10",children:[e.jsxs("div",{className:"grid grid-cols-[30px_70px_1fr_70px_70px] sm:grid-cols-[repeat(2,110px)_3fr_1fr_1fr] gap-1 sm:gap-4 text-center font-bold py-2 px-4 bg-blue-300 text-gray-950 sticky top-0 z-10",children:[e.jsx("div",{children:"No"}),e.jsx("div",{children:"ID"}),e.jsx("div",{children:"Name"}),e.jsx("div",{children:"Courses"}),e.jsx("div",{children:"Actions"})]}),_?e.jsx("div",{className:"text-center p-4 text-gray-700",children:"Loading students..."}):m.length===0?e.jsxs("div",{className:"text-center p-4 text-gray-600",children:["No students found in batch ",a]}):m.map((t,o)=>e.jsxs("div",{className:"border-b px-4 relative",children:[e.jsxs("div",{className:"grid grid-cols-[30px_70px_1fr_70px_70px] sm:grid-cols-[repeat(2,110px)_3fr_1fr_1fr] gap-1 sm:gap-4 text-center items-center py-2 text-gray-900",children:[e.jsx("div",{children:o+1}),e.jsx("div",{children:t.stdId}),e.jsx("div",{children:t.name}),e.jsx("button",{onClick:()=>D(t.id,t.currentSem),className:"flex justify-center",children:e.jsx(O,{className:`size-7 text-violet-500 bg-white rounded hover:bg-gray-200 transition duration-300 cursor-pointer ${u===t.id?"rotate-[-180deg]":""}`})}),e.jsxs("div",{className:"flex justify-center gap-2 [&_button]:cursor-pointer",children:[e.jsx("button",{className:"hover:bg-blue-300 p-2 rounded",onClick:()=>k(t.id),children:e.jsx(T,{size:20,color:"blue"})}),e.jsx("button",{className:"hover:bg-blue-200 p-2 rounded ",onClick:()=>$(t.id),children:e.jsx(U,{size:20,color:`${t.suspend?"red":"green"}`})}),e.jsx("button",{className:"hover:bg-red-200 p-2 rounded",onClick:()=>E(t.id,t.currentSem),children:e.jsx(W,{size:20,color:"red"})})]})]}),u===t.id&&e.jsx("div",{className:"mt-2 mb-4 py-2 rounded-md bg-sky-100 space-y-2 [direction:rtl]",children:A?e.jsx("p",{className:"text-center py-4",children:"جاري تحميل بيانات الطالب..."}):e.jsxs("div",{className:"grid grid-cols-4 gap-4 p-4 items-center",children:[e.jsx("div",{className:"font-bold text-gray-700 text-center",children:"اسم المقرر"}),e.jsx("div",{className:"font-bold text-gray-700 text-center",children:"التقدير الحالي"}),e.jsx("div",{className:"font-bold text-gray-700 text-center",children:"إضافة تقدير جديد"}),e.jsx("div",{className:"font-bold text-gray-700 text-center",children:"إضافة درجة جديدة"}),t.stdCourses?.map((s,l)=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold text-center",children:s.name},`${l}-name`),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-sm text-gray-700",children:s.grade||"N/A"}),e.jsx("p",{className:"text-sm text-gray-700",children:s.degree??"N/A"})]},`${l}-current`),e.jsx("div",{className:"flex justify-center",children:e.jsxs("select",{value:s.name&&h[s?.name]?.grade||"",onChange:d=>{if(!s?.name)return;const i=s.name;g(r=>({...r,[i]:{...r[i],grade:d.target.value}}))},className:"border px-2 py-1 rounded w-full max-w-[120px]",children:[e.jsx("option",{value:"",children:"التقدير"}),B.map(d=>e.jsx("option",{value:d,children:d},d))]})},`${l}-grade`),e.jsx("div",{className:"flex justify-center",children:e.jsx("input",{type:"number",min:0,max:100,placeholder:"الدرجة",value:s.name&&h[s.name]?.degree||"",onChange:d=>{if(!s.name)return;const i=s.name;g(r=>({...r,[i]:{...r[i],degree:Number(d.target.value)}}))},className:"border px-2 py-1 rounded w-full max-w-[100px] text-center"})},`${l}-degree`)]})),e.jsx("div",{className:"col-span-4 flex justify-center mt-4",children:e.jsx("button",{className:"bg-green-700 text-white px-6 py-2 rounded cursor-pointer",onClick:()=>I(t.id),disabled:j,children:j?"جاري التحديث...":"حفظ البيانات"})})]})})," "]},t?.id)),e.jsx("div",{className:"text-center fixed bottom-0 right-80 my-8",children:e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white font-bold px-6 py-2 rounded cursor-pointer",onClick:w,children:"+ إضافة طالب جديد"})})]})},H);function H(n,a){return n.selectedBatchId===a.selectedBatchId&&n.showNewStdForm===a.showNewStdForm&&n.students===a.students&&n.studentsLoading===a.studentsLoading&&n.handleEditStd.toString()===a.handleEditStd.toString()&&n.handleSuspend.toString()===a.handleSuspend.toString()&&n.handleDeleteStd.toString()===a.handleDeleteStd.toString()}export{X as default};
