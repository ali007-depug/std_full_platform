const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SidePanel-BYpY2f1Q.js","assets/index-Dk-OxXFp.js","assets/react-Csw2ODfV.js","assets/firebase-BHdF2iRg.js","assets/index-_vC9JE1J.css","assets/iconBase-D_2xI_Qm.js","assets/index-D8YoPKeB.js","assets/PopupError-Cok8pB-Z.js","assets/StudnetInfo-DBnXqUAd.js"])))=>i.map(i=>d[i]);
import{r,j as e,A as ae,_ as L,g as T,u as Te}from"./index-Dk-OxXFp.js";import{C as ue,P as Ue,I as he}from"./PopupError-Cok8pB-Z.js";import{G as Y,I as oe}from"./iconBase-D_2xI_Qm.js";import{c as se}from"./react-Csw2ODfV.js";function rt(s){return Y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"m18.707 12.707-1.414-1.414L13 15.586V6h-2v9.586l-4.293-4.293-1.414 1.414L12 19.414z"},child:[]}]})(s)}function Me(s){return Y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"m7 17.013 4.413-.015 9.632-9.54c.378-.378.586-.88.586-1.414s-.208-1.036-.586-1.414l-1.586-1.586c-.756-.756-2.075-.752-2.825-.003L7 12.583v4.43zM18.045 4.458l1.589 1.583-1.597 1.582-1.586-1.585 1.594-1.58zM9 13.417l6.03-5.973 1.586 1.586-6.029 5.971L9 15.006v-1.589z"},child:[]},{tag:"path",attr:{d:"M5 21h14c1.103 0 2-.897 2-2v-8.668l-2 2V19H8.158c-.026 0-.053.01-.079.01-.033 0-.066-.009-.1-.01H5V5h6.847l2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2z"},child:[]}]})(s)}function pe(s){return Y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M11.001 10h2v5h-2zM11 16h2v2h-2z"},child:[]},{tag:"path",attr:{d:"M13.768 4.2C13.42 3.545 12.742 3.138 12 3.138s-1.42.407-1.768 1.063L2.894 18.064a1.986 1.986 0 0 0 .054 1.968A1.984 1.984 0 0 0 4.661 21h14.678c.708 0 1.349-.362 1.714-.968a1.989 1.989 0 0 0 .054-1.968L13.768 4.2zM4.661 19 12 5.137 19.344 19H4.661z"},child:[]}]})(s)}function ct(s){return Y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M16 13v-2H7V8l-5 4 5 4v-3z"},child:[]},{tag:"path",attr:{d:"M20 3h-9c-1.103 0-2 .897-2 2v4h2V5h9v14h-9v-4H9v4c0 1.103.897 2 2 2h9c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2z"},child:[]}]})(s)}function Ve(s){return Y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M19 11h-6V5h-2v6H5v2h6v6h2v-6h6z"},child:[]}]})(s)}function ze(s){return Y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 2a5 5 0 1 0 5 5 5 5 0 0 0-5-5zm0 8a3 3 0 1 1 3-3 3 3 0 0 1-3 3zm9 11v-1a7 7 0 0 0-7-7h-4a7 7 0 0 0-7 7v1h2v-1a5 5 0 0 1 5-5h4a5 5 0 0 1 5 5v1z"},child:[]}]})(s)}const Oe=r.memo(function({batches:a,fetchBatches:B,batchLoading:p,closeBatchInfo:C,handleSelectedBatchId:N,deleteBatch:b,handleArchiveBatch:E}){const[v,o]=r.useState(null),[i,g]=r.useState(""),[h,y]=r.useState("");async function G(j){try{const{doc:D,collection:U,updateDoc:k,setDoc:_,getDocs:F}=await L(async()=>{const{doc:P,collection:q,updateDoc:R,setDoc:Z,getDocs:V}=await import("./firebase-BHdF2iRg.js").then(z=>z.e);return{doc:P,collection:q,updateDoc:R,setDoc:Z,getDocs:V}},[]),M=await T(),u=D(M,"batches",j),I=h.split(",").map(P=>({name:P.trim(),grade:null})).filter(P=>P.name);await k(u,{currentSem:i,courses:I});const H=U(M,`batches/${j}/students`),X=(await F(H)).docs.map(async P=>{const q=P.id,R=D(M,`batches/${j}/students/${q}`);await k(R,{currentSem:i});const Z=U(M,`batches/${j}/students/${q}/semesters/${i}/courses`),V=I.map(z=>{const J=D(Z,z.name.toLowerCase());return _(J,z)});await Promise.all(V)});await Promise.all(X),o(null),g(""),y(""),B()}catch(D){console.error("Update failed:",D)}}return e.jsxs("div",{className:`relative flex flex-col h-full p-4 text-white bg-sky-900 rounded  overflow-y-auto [direction:rtl]  ${a?.length===0&&"justify-center"}`,children:[e.jsx(ue,{closeFunc:C}),e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:`text-2xl font-bold mb-4 ${a?.length===0&&"hidden"}`,children:"إدارة الدفعات"})}),p?e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:e.jsx(ae,{loadingMsg:"جار تحميل البيانات...",textSize:"text-xl"})}):a?.length!==0?e.jsx("div",{className:"flex flex-wrap gap-4 ",children:a?.map(j=>e.jsxs("div",{className:"bg-gray-800 p-4 rounded mb-4 shadow-lg w-full min-h-[190px] relative flex flex-col items-center",children:[e.jsxs("div",{className:"items-center space-y-2 [&_p]:grid [&_p]:grid-cols-[100px_1fr] [&_p]:gap-3 [&_strong]:col-start-1 [&_span]:col-start-2 [&_span]:font-semibold",children:[e.jsxs("p",{className:"",children:[e.jsx("strong",{children:"الدفعة:"}),e.jsx("span",{children:j.id})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"الفصل الحالي:"}),e.jsx("span",{children:j.currentSem})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"المقررات:"}),e.jsx("span",{className:"flex gap-4",children:j.courses?.map((D,U)=>e.jsx("span",{className:"",children:D?.name},U))||"لا توجد مقررات"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"تمت أرشفتها؟"}),e.jsx("span",{children:j.archived?"نعم":"لا"})]})]}),v===j?.id?e.jsxs("div",{className:"mt-4 w-fit",children:[e.jsx("input",{type:"text",placeholder:"الفصل الحالي الجديد",value:i,onChange:D=>g(D.target.value),className:"mb-2 p-2 rounded w-full bg-white text-black"}),e.jsx("input",{type:"text",placeholder:"مقررات مفصولة بفاصلة",value:h,onChange:D=>y(D.target.value),className:"mb-2 p-2 rounded w-full bg-white text-black"}),e.jsxs("div",{className:"flex gap-3 [&_button]:cursor-pointer [&_button]:transition-all [&_button]:duration-300 [&_button]:ease-in-out ",children:[e.jsx("button",{className:"bg-green-600 hover:bg-green-700 px-4 py-2 rounded mr-2",onClick:()=>G(j?.id),children:"حفظ"}),e.jsx("button",{className:"bg-red-500 hover:bg-red-600 px-4 py-2 rounded",onClick:()=>o(null),children:"إلغاء"})]})]}):e.jsxs("div",{className:"flex mt-4 gap-2 justify-around relative bottom-5 flex-wrap [&_button]:transition-all [&_button]:duration-300 [&_button]:ease-in-out",children:[e.jsx("button",{className:"mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded cursor-pointer",onClick:()=>o(j?.id),children:"تعديل الفصل والمقررات"}),e.jsxs("button",{onClick:()=>N(j?.id),className:"mt-4 bg-sky-500 hover:bg-sky-600 px-4 py-2 rounded cursor-pointer",children:["عرض طلاب الدفعة ",j.id]}),e.jsx("button",{onClick:()=>b(j?.id),className:"mt-4 bg-red-600 hover:bg-red-500 px-4 py-2 rounded cursor-pointer",children:"حذف الدفعة"}),e.jsx("button",{onClick:()=>E(j?.id),className:"mt-4 bg-green-600 hover:bg-green-700 px-4 py-2 rounded cursor-pointer",children:"أرشفة الدفعة"})]})]},j?.id))}):e.jsxs("h2",{className:"text-gray-400 flex items-center gap-2 self-center text-2xl",children:["لا توجد دفعات لعرضها",e.jsx(pe,{color:"red"})]})]})}),Fe=r.memo(function({options:a,currentSem:B,setCurrentSem:p}){return console.log("##list box rendered..."),e.jsx("div",{className:"w-full",children:e.jsx("select",{name:"semesters",value:B??"",onChange:C=>p(C.target.value),className:"w-full p-2 bg-white rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-center font-semibold",children:a!==null&&a.map((C,N)=>e.jsx("option",{value:C,children:C},N))})})}),ie=["إختيار الفصل الحالي","1","2","3","4","5","6","7","8","9","10","11","12"],He=r.memo(function({closeNewBatchUI:a,fetchBatches:B,setShowUI:p,setToastMsg:C}){console.log("New batch input component rendered...");const[N,b]=r.useState(""),[E,v]=r.useState(ie[0]),[o,i]=r.useState(""),[g,h]=r.useState([]),[y,G]=r.useState(!1),[j,D]=r.useState(!1),U=r.useCallback(u=>{v(u)},[]),k=()=>{o.trim()&&!g.some(u=>u.name===o.trim())&&(h([...g,{name:o.trim(),grade:null,degree:null}]),i(""))},_=u=>{h(I=>I.filter(H=>H.name!==u))},F=u=>{b(u)},M=async u=>{u.preventDefault(),G(!0);try{const{doc:I,setDoc:H,getDoc:W}=await L(async()=>{const{doc:R,setDoc:Z,getDoc:V}=await import("./firebase-BHdF2iRg.js").then(z=>z.e);return{doc:R,setDoc:Z,getDoc:V}},[]),X=await T(),P=I(X,"batches",N);if((await W(P)).exists()){console.log(`Batch with name ${N} already exists.`),D(!0);return}else{console.log(`${N} does not exist, proceeding to add it?`);try{await H(P,{currentSem:E,courses:g,archived:!1,createdAt:new Date}),b(""),v(null),h([])}catch(R){console.error("Error creating batch:",R)}finally{G(!1),p(R=>({...R,default:!0,toast:!0})),C("تم إضافة الدفعة بنجاح"),setTimeout(()=>{C(""),p(R=>({...R,newBatchInput:!1,toast:!1}))},1500)}}}catch(I){console.error("Error checking batch existence:",I)}finally{G(!1)}typeof B=="function"&&B()};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:M,className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 [direction:rtl] bg-cyan-700 border border-white shadow shadow-white px-5 py-10 w-[min(98%,450px)]",children:[e.jsx(ue,{closeFunc:a}),e.jsx(oe,{type:"text",value:N,onChange:F,label:"رقم الدفعة"}),e.jsx(Fe,{options:ie,currentSem:E,setCurrentSem:U}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold my-3 text-white",children:" اسم المقرر:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:u=>i(u.target.value),className:"border p-2 flex-1 rounded bg-white",placeholder:"مثال: Math"}),e.jsx("button",{type:"button",onClick:k,className:"bg-green-400 font-semibold text-black hover:text-white px-4 py-2 rounded hover:bg-green-600 cursor-pointer transition-all duration-300 ease-linear",children:"إضافة"})]})]}),g.length>0&&e.jsx("ul",{className:`mt-3 space-y-1 max-h-[200px] overflow-y-scroll ${g.length>=3&&"flex [&_li]:w-[47%]  flex-wrap gap-5"}`,children:g.map((u,I)=>e.jsxs("li",{className:"bg-gray-100 py-1 px-3 rounded flex justify-between items-center ",children:[e.jsx("span",{children:u.name}),e.jsx("button",{onClick:()=>_(u.name),type:"button",className:"text-red-500 hover:bg-red-200 px-3  py-2 font-bold cursor-pointer transition-all duration-200 ease-out rounded",children:"❌"})]},I))}),e.jsx("button",{type:"submit",className:"cursor-pointer px-3 py-1 mt-10 rounded bg-cyan-400 w-full flex justify-center",children:y?e.jsx(ae,{loadingMsg:"جار الإضافة"}):"إضافة إلى قاعدة البيانات"})]}),j&&e.jsx(Ue,{closePopupError:()=>D(!1),msg:`الدفعة ${N} موجودة بالفعل`})]})});function fe(s){return Y({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"},child:[]}]})(s)}function me({msg:s}){return e.jsxs("div",{className:"flex items-center gap-2 bg-green-500  w-fit  rounded px-3 py-2 absolute bottom-[-50px] left-0 ",children:[e.jsx(fe,{size:25,color:"black"}),s]})}const Ge=(s,a)=>{switch(a.type){case"stdName":return{...s,stdName:a.newValue};case"stdBatch":return{...s,stdBatch:a.newValue};case"std_id":return{...s,std_id:a.newValue};case"reset":return{stdName:"",std_id:"",stdBatch:null,stdGrade:"",stdCourse:""};default:return s}};function qe({closeNewStdForm:s,fetchStudents:a,selectedBatchId:B,oldStudent:p,editedId:C,setShowUI:N}){const E=p?{stdName:p.name,stdBatch:p.stdBatch,std_id:p.stdId,stdGrade:"",stdCourse:""}:{stdName:"",stdBatch:B||null,std_id:"",stdGrade:"",stdCourse:""},[v,o]=r.useReducer(Ge,E),[i,g]=r.useState(!1),[h,y]=r.useState(!1);r.useEffect(()=>{p&&(o({type:"stdName",newValue:p.name}),o({type:"stdBatch",newValue:B}),o({type:"std_id",newValue:p.stdId}))},[B,p]);const G=k=>{o({type:"stdName",newValue:k})},j=k=>{o({type:"stdBatch",newValue:k})},D=k=>{o({type:"std_id",newValue:k})},U=async k=>{if(k.preventDefault(),C)try{if(y(!0),v.stdBatch!==null){const _=await T(),{doc:F,setDoc:M,getDoc:u}=await L(async()=>{const{doc:q,setDoc:R,getDoc:Z}=await import("./firebase-BHdF2iRg.js").then(V=>V.e);return{doc:q,setDoc:R,getDoc:Z}},[]),I=F(_,"batches",v.stdBatch),H=await u(I);if(!H.exists())throw new Error("Batch does not exist");const X=H.data().currentSem,P=F(_,`batches/${v.stdBatch}/students/${C}`);await M(P,{name:v.stdName,stdId:v.std_id,currentSem:X},{merge:!0})}}catch(_){console.error("❌ Error updating student:",_)}finally{y(!1),g(!0),setTimeout(()=>{g(!1),N(_=>({..._,NewStdFrom:!1}))},1e3)}else try{if(y(!0),v.stdBatch!==null){const _=await T(),{doc:F,setDoc:M,getDoc:u,collection:I}=await L(async()=>{const{doc:V,setDoc:z,getDoc:J,collection:te}=await import("./firebase-BHdF2iRg.js").then(re=>re.e);return{doc:V,setDoc:z,getDoc:J,collection:te}},[]),H=F(_,"batches",v.stdBatch),W=await u(H);if(!W.exists())throw new Error("Batch does not exist");const X=W.data(),P=X.currentSem,q=X.courses||[],R=F(I(_,`batches/${v.stdBatch}/students`));await M(R,{name:v.stdName,stdId:v.std_id,currentSem:P,suspend:!1});const Z=I(_,`batches/${v.stdBatch}/students/${R.id}/semesters/${P}/courses`);for(const V of q){const z=F(Z,V.name.toLowerCase());await M(z,{name:V.name,grade:null,degree:null})}}}catch(_){console.error("❌ Error adding student:",_)}finally{y(!1),g(!0),setTimeout(()=>{g(!1)},1500)}o({type:"reset"}),typeof a=="function"&&a(B)};return e.jsxs("form",{onSubmit:U,className:"fixed z-10 w-[min(80%,550px)] [direction:rtl] flex flex-col gap-3 px-5 py-15 bg-gray-500 border-2 border-white rounded top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%]",children:[e.jsx(he,{size:50,color:"white",className:"absolute top-0 right-0 cursor-pointer hover:bg-red-500 transition-all duration-300 ease-in-out p-2 rounded",onClick:s}),e.jsx(oe,{type:"text",label:"اسم الطالب",value:v.stdName,onChange:G,customStyle:"text-center"}),e.jsx(oe,{type:"text",label:"الدفعة",value:v.stdBatch,onChange:j,customStyle:"text-center ![direction:ltr]"}),e.jsx(oe,{type:"text",label:"رقم التسجيل",value:v.std_id,onChange:D,customStyle:"text-center [direction:ltr]"}),e.jsx("button",{type:"submit",disabled:h,className:`flex justify-center items-center font-bold  px-3 py-2 w-full rounded cursor-pointer bg-teal-400 hover:bg-teal-600 text-title-color hover:text-white transition duration-300 ease-in-out ${h&&"opacity-50"}`,children:C?e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:25}),"تعديل"," "]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{size:25}),"إضافة"]})}),i&&e.jsx(me,{msg:" تم الإضافة بنجاح"})]})}function Ze({yesAction:s,closeConfirm:a,confirmMsg:B}){return e.jsxs("div",{className:"absolute w-[300px] rounded  top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%] bg-white flex gap-8 flex-col p-4 border-2 border-bg-color shadow-md",children:[e.jsxs("h1",{className:"text-center font-semibold",children:["هل أنت متأكد من  ",B,"؟"]}),e.jsxs("div",{className:"flex justify-evenly",children:[e.jsx("span",{className:"block px-4 py-1 rounded cursor-pointer hover:bg-green-400 bg-green-800 text-white font-bold",onClick:s,children:"نعم"}),e.jsx("span",{className:"block px-4 py-1 rounded cursor-pointer hover:bg-red-400 bg-red-800 text-white font-bold",onClick:a,children:"لا"})]})]})}function lt(s){return Y({attr:{viewBox:"0 0 24 24",fill:"none"},child:[{tag:"path",attr:{d:"M8.46457 14.1213C8.07404 14.5118 8.07404 15.145 8.46457 15.5355C8.85509 15.926 9.48825 15.926 9.87878 15.5355L15.5356 9.87862C15.9262 9.4881 15.9262 8.85493 15.5356 8.46441C15.1451 8.07388 14.5119 8.07388 14.1214 8.46441L8.46457 14.1213Z",fill:"currentColor"},child:[]},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M6.34315 17.6569C9.46734 20.781 14.5327 20.781 17.6569 17.6569C20.781 14.5327 20.781 9.46734 17.6569 6.34315C14.5327 3.21895 9.46734 3.21895 6.34315 6.34315C3.21895 9.46734 3.21895 14.5327 6.34315 17.6569ZM16.2426 16.2426C13.8995 18.5858 10.1005 18.5858 7.75736 16.2426C5.41421 13.8995 5.41421 10.1005 7.75736 7.75736C10.1005 5.41421 13.8995 5.41421 16.2426 7.75736C18.5858 10.1005 18.5858 13.8995 16.2426 16.2426Z",fill:"currentColor"},child:[]}]})(s)}function We(s){return Y({attr:{viewBox:"0 0 24 24",fill:"none"},child:[{tag:"path",attr:{d:"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z",fill:"currentColor"},child:[]}]})(s)}const Xe=r.memo(function({allUsers:a,pendingUsers:B,handleApproveUser:p,handleRejectUser:C,closePendingUsers:N}){return e.jsxs("div",{className:"rounded w-full bg-sky-900 text-white font-semibold min-h-[100dvh] flex flex-col  shadow-md shadow-black px-10",children:[e.jsx("p",{className:"mx-auto w-fit text-4xl font-bold  p-2 rounded",children:"المستخدمين"}),e.jsx(he,{size:50,color:"black",className:"absolute top-0 right-0 cursor-pointer hover:bg-red-500 transition-all duration-300 ease-in-out p-2 rounded",onClick:N}),e.jsxs("div",{className:"flex justify-between mt-30 w-full",children:[e.jsxs("div",{className:"flex flex-col rounded shadow shadow-white items-center w-1/2 bg-sky-950 py-10",children:[e.jsx("p",{className:"mb-15 text-xl",children:"كل المستخدمين"}),a.length>0?a.map((b,E)=>e.jsx("div",{className:"flex items-center w-fit h-fit",children:e.jsxs("p",{className:"font-semibold text-lg",children:[++E,"- ",b?.name]})},E)):e.jsxs("p",{className:" relative flex items-center gap-3 text-gray-200 text-xl mx-auto",children:[e.jsx(pe,{color:"red",size:25})," لا يوجد مستخدمين "]})]}),e.jsxs("div",{className:"flex flex-col rounded shadow shadow-white items-center w-1/2 bg-sky-700 py-10",children:[e.jsx("p",{className:"mb-10 text-xl",children:"حسابات تنتظر التأكيد"}),B.length>0?B.map((b,E)=>e.jsxs("div",{className:"flex gap-2 mt-3 items-center justify-between w-fit h-fit",children:[e.jsxs("p",{className:"font-semibold flex items-center gap-2 text-lg text-p-color",children:[e.jsx(ze,{size:25})," ",b?.name]}),e.jsx("p",{children:e.jsx(fe,{size:35,color:"green",className:"p-2 bg-white rounded hover:bg-green-200 cursor-pointer",onClick:()=>p(b)})}),e.jsx("p",{children:e.jsx(We,{size:35,color:"red",className:"p-2 bg-white rounded hover:bg-red-200 cursor-pointer",onClick:()=>C(b.id)})})]},E)):e.jsx("p",{className:" relative top-5 mb-10 mx-auto",children:"لا يوجد حسابات تنتظر التأكيد"})]})]})]})});var ne={exports:{}},Ye=ne.exports,de;function Ke(){return de||(de=1,function(s,a){(function(B,p){p()})(Ye,function(){function B(o,i){return typeof i>"u"?i={autoBom:!1}:typeof i!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function p(o,i,g){var h=new XMLHttpRequest;h.open("GET",o),h.responseType="blob",h.onload=function(){v(h.response,i,g)},h.onerror=function(){console.error("could not download file")},h.send()}function C(o){var i=new XMLHttpRequest;i.open("HEAD",o,!1);try{i.send()}catch{}return 200<=i.status&&299>=i.status}function N(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(i)}}var b=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof se=="object"&&se.global===se?se:void 0,E=b.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),v=b.saveAs||(typeof window!="object"||window!==b?function(){}:"download"in HTMLAnchorElement.prototype&&!E?function(o,i,g){var h=b.URL||b.webkitURL,y=document.createElement("a");i=i||o.name||"download",y.download=i,y.rel="noopener",typeof o=="string"?(y.href=o,y.origin===location.origin?N(y):C(y.href)?p(o,i,g):N(y,y.target="_blank")):(y.href=h.createObjectURL(o),setTimeout(function(){h.revokeObjectURL(y.href)},4e4),setTimeout(function(){N(y)},0))}:"msSaveOrOpenBlob"in navigator?function(o,i,g){if(i=i||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(B(o,g),i);else if(C(o))p(o,i,g);else{var h=document.createElement("a");h.href=o,h.target="_blank",setTimeout(function(){N(h)})}}:function(o,i,g,h){if(h=h||open("","_blank"),h&&(h.document.title=h.document.body.innerText="downloading..."),typeof o=="string")return p(o,i,g);var y=o.type==="application/octet-stream",G=/constructor/i.test(b.HTMLElement)||b.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||y&&G||E)&&typeof FileReader<"u"){var D=new FileReader;D.onloadend=function(){var _=D.result;_=j?_:_.replace(/^data:[^;]*;/,"data:attachment/file;"),h?h.location.href=_:location=_,h=null},D.readAsDataURL(o)}else{var U=b.URL||b.webkitURL,k=U.createObjectURL(o);h?h.location=k:location.href=k,h=null,setTimeout(function(){U.revokeObjectURL(k)},4e4)}});b.saveAs=v.saveAs=v,s.exports=v})}(ne)),ne.exports}var Je=Ke();const Qe=r.lazy(()=>L(()=>import("./SidePanel-BYpY2f1Q.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),et=r.lazy(()=>L(()=>import("./StudnetInfo-DBnXqUAd.js"),__vite__mapDeps([8,1,2,3,4,5,7])));function tt(){const[s,a]=r.useState({default:!0,NewStdFrom:!1,confirmPopup:!1,batchArchPopUp:!1,deleteBatchPopUp:!1,pendignUsers:!1,toast:!1,newBatchInput:!1,showBatchInfo:!1,showStudnetInfo:!1}),[B,p]=r.useState(""),[C,N]=r.useState(""),[b,E]=r.useState([]),[v,o]=r.useState(!1),[i,g]=r.useState([]),[h,y]=r.useState(!1),[G,j]=r.useState(null),[D,U]=r.useState(),[k,_]=r.useState(null),[F,M]=r.useState(!1),[u,I]=r.useState(""),[H,W]=r.useState([]),[X,P]=r.useState([]),[q,R]=r.useState(""),{batches:Z,batchLoading:V,fetchBatches:z,setBatches:J}=Te();r.useEffect(()=>{xe(),we()},[]);const te=r.useCallback(async t=>{const{collection:c,getDocs:x}=await L(async()=>{const{collection:l,getDocs:n}=await import("./firebase-BHdF2iRg.js").then(d=>d.e);return{collection:l,getDocs:n}},[]),S=await T();try{M(!0),console.log("fetching students data...");const l=c(S,`batches/${t}/students`),n=await x(l);let d=[];d=await Promise.all(n.docs.map(async m=>{const f=m.data();return{id:m.id,name:f.name||"",stdId:f.stdId||"",stdBatch:f.stdBatch||t,currentSem:f.currentSem||"",suspend:f.suspend||!1}}));const w=d.sort((m,f)=>{const[A,,O]=m.stdId.split("/"),[$,,K]=f.stdId.split("/");return parseInt($)-parseInt(A)||parseInt(O)-parseInt(K)});E(w)}catch(l){console.error("Error fetching students:",l)}finally{M(!1)}},[]),re=async t=>{const{collection:c,getDocs:x}=await L(async()=>{const{collection:l,getDocs:n}=await import("./firebase-BHdF2iRg.js").then(d=>d.e);return{collection:l,getDocs:n}},[]),S=await T();try{y(!0);const l=c(S,`batches/${t}/students`),n=await x(l),d=await Promise.all(n.docs.map(async w=>{const m=w.id,f=w.data(),A=[];for(let O=1;O<=12;O++){const $=O.toString(),K=c(S,`batches/${t}/students/${m}/semesters/${$}/courses`);try{(await x(K)).docs.forEach(ce=>{const ee=ce.data();A.push({id:m,name:f.name||"",stdId:f.stdId||"",currentSem:$,courseName:ee.name||"",degree:ee.degree||"",grade:ee.grade||""})})}catch(Q){console.warn(`⚠️ Error fetching semester ${$} for ${m}:`,Q)}}return A}));g(d.flat())}catch(l){throw console.error("🔥 Error fetching student data:",l),l}finally{y(!1)}},xe=r.useCallback(async()=>{const{doc:t,getDoc:c}=await L(async()=>{const{doc:d,getDoc:w}=await import("./firebase-BHdF2iRg.js").then(m=>m.e);return{doc:d,getDoc:w}},[]),{getAuth:x}=await L(async()=>{const{getAuth:d}=await import("./firebase-BHdF2iRg.js").then(w=>w.f);return{getAuth:d}},[]),S=x(),l=await T(),n=S.currentUser;if(n){const d=t(l,"users",n.uid),w=await c(d);if(w.exists()){const m=w.data();R(m.name)}else console.log("no teacher")}try{const{collection:d,getDocs:w}=await L(async()=>{const{collection:$,getDocs:K}=await import("./firebase-BHdF2iRg.js").then(Q=>Q.e);return{collection:$,getDocs:K}},[]),m=await T(),f=d(m,"users"),O=(await w(f)).docs.map($=>({id:$.id,name:$.data().name||"Unknown",...$.data()}));P(O)}catch(d){console.log(`all users error is : ${d}`)}},[]),we=r.useCallback(async()=>{try{const{collection:t,getDocs:c}=await L(async()=>{const{collection:n,getDocs:d}=await import("./firebase-BHdF2iRg.js").then(w=>w.e);return{collection:n,getDocs:d}},[]),x=await T(),l=(await c(t(x,"pending-users"))).docs.map(n=>({id:n.id,name:n.data().name||"Unknown",...n.data()}));W(l),console.log(`the pending users are ${l}`)}catch(t){console.log(`pending users error : ${t}`)}},[]),le=()=>{a({...s,default:!s.default,pendignUsers:!s.pendignUsers})},ge=r.useCallback(async t=>{try{const{setDoc:c,doc:x,deleteDoc:S}=await L(async()=>{const{setDoc:n,doc:d,deleteDoc:w}=await import("./firebase-BHdF2iRg.js").then(m=>m.e);return{setDoc:n,doc:d,deleteDoc:w}},[]),l=await T();await c(x(l,"users",t.id),{name:t.name,email:t.email,approveAt:new Date}),await S(x(l,"pending-users",t.id)),W(n=>n.filter(d=>d.id!==t.id)),a(n=>({...n,toast:!0})),p("تم القبول بنجاح"),setTimeout(()=>{a(n=>({...n,toast:!1})),p("")},1500)}catch(c){console.log(`approve pending error is : ${c}`)}},[]),be=r.useCallback(async t=>{try{const{doc:c,deleteDoc:x}=await L(async()=>{const{doc:l,deleteDoc:n}=await import("./firebase-BHdF2iRg.js").then(d=>d.e);return{doc:l,deleteDoc:n}},[]),S=await T();await x(c(S,"pending-users",t)),a(l=>({...l,toast:!0})),p("تم الرفض بنجاح"),setTimeout(()=>{a(l=>({...l,toast:!1})),p("")},1500),W(l=>l.filter(n=>n.id!==t))}catch(c){console.log(`reject user Error is : ${c}`)}},[]),ve=()=>{a(t=>({...t,default:!t.default,newBatchInput:!t.newBatchInput}))},ye=()=>{a({...s,default:!0,newBatchInput:!1})},je=()=>{a(t=>({...t,default:!t.default,showBatchInfo:!t.showBatchInfo,showStudnetInfo:!1}))},_e=t=>{console.log("confirm popup for batch"),a({...s,confirmPopup:!0,deleteBatchPopUp:!0}),N(" حذف هذه الدفعة"),I(t)};async function Se(t){o(!0);try{const{collection:c,doc:x,deleteDoc:S,getDocs:l}=await L(async()=>{const{collection:d,doc:w,deleteDoc:m,getDocs:f}=await import("./firebase-BHdF2iRg.js").then(A=>A.e);return{collection:d,doc:w,deleteDoc:m,getDocs:f}},[]),n=await T();if(t!==null){const d=x(n,"batches",t),w=c(n,`batches/${t}/students`),m=await l(w);for(const f of m.docs){const A=f.id,O=c(n,`batches/${t}/students/${A}/semesters`),$=await l(O);for(const K of $.docs){const Q=K.id,ce=c(n,`batches/${t}/students/${A}/semesters/${Q}/courses`),ee=await l(ce);await Promise.all(ee.docs.map(Ae=>S(Ae.ref))),await S(K.ref)}await S(f.ref)}await S(d),console.log(`✅ Batch ${t} and all its data deleted`)}}catch(c){console.error("❌ Error deleting batch:",c)}finally{o(!1),a({...s,toast:!0,confirmPopup:!1}),p("تم حذف الدفعة بنجاح"),setTimeout(()=>{a(c=>({...c,toast:!1}))},1500),J(c=>c?.filter(x=>x.id!==t))}}const Ne=r.useCallback(t=>{a(c=>({...c,showStudnetInfo:!0,showBatchInfo:!1})),t!==u&&(console.log("set New batch"),I(c=>c!==t?t:c))},[u]),De=async t=>{console.log("archiving batch"+t),a({...s,confirmPopup:!0,deleteBatchPopUp:!1}),N("من أرشفة هذه الدفعة"),I(t)},Be=async()=>{if(await re(u),u!==null){const{setDoc:t,doc:c}=await L(async()=>{const{setDoc:l,doc:n}=await import("./firebase-BHdF2iRg.js").then(d=>d.e);return{setDoc:l,doc:n}},[]),x=await T(),S=c(x,"batches",u);await t(S,{archived:!0},{merge:!0}),J(l=>l.map(n=>n.id===u?{...n,archived:!0}:n)),Ce(i,`${u}_students.xlsx`),a({...s,confirmPopup:!1})}},Ce=async(t,c="students.xlsx")=>{const{utils:x,write:S}=await L(async()=>{const{utils:m,write:f}=await import("./xlsx-0t73lcZ1.js");return{utils:m,write:f}},[]),l=x.json_to_sheet(t),n=x.book_new();x.book_append_sheet(n,l,"Students");const d=S(n,{bookType:"xlsx",type:"array"}),w=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});Je.saveAs(w,c)},Ee=r.useCallback(t=>{N("حذف هذا الطالب"),a({...s,confirmPopup:!0}),j(t)},[s]),Ie=r.useCallback(async t=>{try{const{collection:c,getDocs:x,doc:S,deleteDoc:l}=await L(async()=>{const{collection:m,getDocs:f,doc:A,deleteDoc:O}=await import("./firebase-BHdF2iRg.js").then($=>$.e);return{collection:m,getDocs:f,doc:A,deleteDoc:O}},[]),n=await T(),d=c(n,`batches/${u}/students/${t}/semesters`),w=await x(d);for(const m of w.docs){const f=m.id,A=c(n,`batches/${u}/students/${t}/semesters/${f}/courses`),O=await x(A);for(const $ of O.docs)await l($.ref);await l(S(n,`batches/${u}/students/${t}/semesters/${f}`))}await l(S(n,`batches/${u}/students/${t}`)),console.log(`✅ Deleted student ${t} and all nested data.`),E(m=>m.filter(f=>f.id!==t))}catch(c){console.log(`the Error while deleting is : ${c}`)}finally{a({...s,toast:!0}),p("تم الحذف بنجاح"),setTimeout(()=>{a({...s,confirmPopup:!1,toast:!1}),p("")},1500)}},[s,u]),Le=r.useCallback(async t=>{const c=b.find(x=>x.id==t);c&&(_(t),a({...s,NewStdFrom:!0}),U(c))},[s,b]),ke=r.useCallback(async t=>{try{const{setDoc:c,doc:x,getDoc:S}=await L(async()=>{const{setDoc:w,doc:m,getDoc:f}=await import("./firebase-BHdF2iRg.js").then(A=>A.e);return{setDoc:w,doc:m,getDoc:f}},[]),l=await T(),n=x(l,`batches/${u}/students`,t),d=await S(n);if(d.exists()){const w=d.data().suspend??!1;await c(n,{suspend:!w},{merge:!0}),E(m=>m.map(f=>f.id===t?{...f,suspend:!f.suspend}:f))}}catch(c){console.log(c)}},[u]),Re=()=>{a({...s,NewStdFrom:!1}),U(null),_(null)},Pe=()=>{a(t=>({...t,confirmPopup:!1}))},$e=()=>{a({...s,NewStdFrom:!0})};return e.jsxs("div",{className:"overflow-hidden bg-bg-color min-h-[100dvh] relative",children:[e.jsx("p",{className:"sr-only",children:"Dashboard"}),e.jsxs("main",{className:" min-h-[100dvh] flex  bg-gray-700",role:"main",children:[e.jsxs("div",{className:"relative bg-gray-700 w-[calc(100%-300px)] px-3",children:[s.default&&e.jsx("div",{className:"flex items-center justify-center absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full",children:e.jsx("p",{className:"text-gray-400 text-8xl  text-center",children:"لوحة التحكم"})}),s.showBatchInfo&&e.jsx(Oe,{batches:Z,fetchBatches:z,closeBatchInfo:()=>a({...s,default:!0,showBatchInfo:!1}),batchLoading:V,handleSelectedBatchId:Ne,setShowToast:t=>a({...s,toast:t}),setToastMsg:t=>p(t),deleteBatch:_e,handleArchiveBatch:De}),s.showStudnetInfo&&e.jsx(r.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(et,{students:b,setStudents:E,fetchStudents:te,selectedBatchId:u,showNewStdForm:$e,studentsLoading:F,handleDeleteStd:Ee,handleEditStd:Le,handleSuspend:ke})}),s.NewStdFrom&&e.jsx(qe,{oldStudent:D,closeNewStdForm:Re,editedId:k,fetchStudents:te,setShowUI:a,showUI:s,selectedBatchId:u}),s.newBatchInput&&e.jsx(He,{fetchBatches:z,closeNewBatchUI:ye,setToastMsg:p,setShowUI:a}),s.confirmPopup&&e.jsx(Ze,{yesAction:s.showStudnetInfo?()=>Ie(G):s.showBatchInfo&&s.deleteBatchPopUp?()=>Se(u):s.showBatchInfo&&!s.deleteBatchPopUp?()=>{Be()}:void 0,closeConfirm:Pe,confirmMsg:C}),s.toast&&e.jsx("div",{className:"fixed bottom-[100px] left-[50px] w-[200px]",children:e.jsx(me,{msg:B})}),v&&e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[300px] rounded shadow-md shadow-sky-200 bg-sky-800 text-white font-semibold text-2xl flex justify-center min-h-40",children:e.jsx(ae,{loadingMsg:"جاري حذف الدفعة"})}),h&&e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[300px] rounded shadow-md shadow-sky-200 bg-sky-800 text-white font-semibold text-2xl flex justify-center min-h-40",children:e.jsx(ae,{loadingMsg:"جار تجهيز بيانات الدفعة"})}),s.pendignUsers&&e.jsx(Xe,{pendingUsers:H,allUsers:X,handleApproveUser:ge,handleRejectUser:be,closePendingUsers:le})]}),e.jsx(r.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(Qe,{showBatchesInfo:je,showNewBatchUI:ve,showPendingUsers:le,currentUser:q})})]})]})}const it=Object.freeze(Object.defineProperty({__proto__:null,default:tt},Symbol.toStringTag,{value:"Module"}));export{ze as B,lt as C,it as D,ct as a,rt as b,Me as c};
